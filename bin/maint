#!/usr/bin/env bash

# Update homebrew and the installed packages
brew=/usr/local/bin/brew
if [[ -x $brew ]]; then
    export HOMEBREW_BAT=1
    export HOMEBREW_NO_ANALYTICS=1
    export HOMEBREW_NO_INSTALL_CLEANUP=1
    export HOMEBREW_NO_ENV_HINTS=1

    $brew update --quiet
    $brew upgrade --quiet --greedy
    $brew cleanup --quiet -s
    $brew doctor

    # hack
    $brew remove --ignore-dependencies php
    $brew link --force php@7.4
else
    echo "$brew not found."
fi

# Atom packages to update - brew updates atom
apm=/usr/local/bin/apm
if [[ -x $apm ]]; then
    $apm upgrade -c false
    $apm clean
else
    echo "$apm not found."
fi

# NPM update packages - brew updates npm.
npm=/usr/local/bin/npm
if [[ -x $npm ]]; then
    $npm update -g
else
    echo "$npm not found.";
fi

# update global composer packages - brew updates composer
composer=/usr/local/bin/composer
if [[ -x $composer ]]; then
    $composer global update
    $composer global clear-cache
else
    echo "$composer not found."
fi

# update the symfony binary - it isn't managed by brew
symfony=/usr/local/bin/symfony
if [[ -x $symfony ]]; then
    $symfony --quiet self:update --yes
else
    echo "$symfony not found."
fi

# run all periodic mantenance
sudo periodic daily weekly monthly

# delete time machien local snapshots
sudo tmutil deletelocalsnapshots /
